# Compiler settings
CC = gcc
CFLAGS = -Wall -Werror -g

# Directories
SRC_DIR = src/stack_calculator
TEST_DIR = tests
UNITY_DIR = unity

# Source files (only the ones we need)
SRC = $(SRC_DIR)/stack_calculator.c
TEST_SRC = $(TEST_DIR)/test_stack_calculator.c $(TEST_DIR)/test_main.c
UNITY_SRC = $(UNITY_DIR)/unity.c

# Object files
OBJ = $(SRC:.c=.o)
TEST_OBJ = $(TEST_SRC:.c=.o)
UNITY_OBJ = $(UNITY_SRC:.c=.o)

# Output executable
TEST_EXEC = test_calculator

# Include paths
INCLUDES = -I$(SRC_DIR) -I$(UNITY_DIR)

# Test target
test: $(TEST_EXEC)
	./$(TEST_EXEC)

$(TEST_EXEC): $(OBJ) $(TEST_OBJ) $(UNITY_OBJ)
	$(CC) $(CFLAGS) -o $@ $^

%.o: %.c
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

clean:
	rm -f $(TEST_EXEC) $(OBJ) $(TEST_OBJ) $(UNITY_OBJ)

.PHONY: test clean